<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>WebSocket Client</title>

	<!-- <script src="gyro-script.js"></script> -->
	<script>
		const socket = new WebSocket("wss://" + location.host);

		const messagesDiv = document.getElementById('messages');
		const messageInput = document.getElementById('messageInput');
		const sendButton = document.getElementById('sendButton');
		const deviceMotion = document.getElementById('deviceMotion');
		const deviceOrientation = document.getElementById('deviceOrientation');
		const clickButton = document.getElementById('clickButton');
		const info = document.getElementById('info');

		let interval;
		let beta = 0, gamma = 0;
		let is_click = false;

		// Event listener for WebSocket open
		socket.addEventListener('open', (event) => {
			console.log('WebSocket connection opened');
			info.textContent = 'WebSocket connection opened!';
		});

		socket.addEventListener('message', (event) => {
			console.log('Message received:', event.data);
			const messageDiv = document.createElement('div');
			messageDiv.textContent = event.data;
			messagesDiv.appendChild(messageDiv);
		});

		socket.addEventListener('close', (event) => {
			console.log('WebSocket connection closed');
			info.textContent = 'WebSocket connection closed';
			clearInterval(interval);
		});

		socket.addEventListener('error', (error) => {
			console.error('WebSocket error:', error);
			clearInterval(interval);
		});

		window.addEventListener('deviceorientation', (event) => {
			beta = event.beta;
			gamma = event.gamma;

			console.log('Device motion:', beta, gamma);
			deviceMotion.textContent = `Beta: ${beta}, Gamma: ${gamma}`;

			if (!beta || !gamma) return;
			if (!socket.readyState === WebSocket.OPEN) return;

			socket.send(`${Math.round(gamma)} ${Math.round(beta)} ${is_click ? 1 : 0}\n`);
			is_click = false;
		});

		clickButton.addEventListener("click", () => {
			is_click = true;
		})
	</script>
</head>

<body>
	<h1>WebSocket Client</h1>
	<div id="messages"></div>
	<input type="text" id="messageInput" placeholder="Enter message...">
	<button id="sendButton">Send</button>
	<p id="deviceMotion">a</p>
	<p id="deviceOrientation">a</p>

	<p id="info"></p>
	<button id="clickButton" style="width: 100%; height: 50em;">Click</button>
</body>

</html>